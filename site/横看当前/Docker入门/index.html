<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.1, mkdocs-material-5.0.2"><title>Docker入门</title><link rel=stylesheet href=../../assets/stylesheets/main.07c9fbf5.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ecd4686e.min.css><meta name=theme-color content=#009688><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style></head> <body dir data-md-color-primary=teal data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#_1 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label> <a href=../.. title=David&amp;Blog class="md-header-nav__button md-logo" aria-label=David&amp;Blog> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z"/></svg> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z /></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> David&Blog </span> <span class="md-header-nav__topic md-ellipsis"> Docker入门 </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z /></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 键入以开始搜索 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class="md-tabs md-tabs--active" aria-label data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> 首页 </a> </li> <li class=md-tabs__item> <a href=../../%E7%BA%B5%E8%A7%82%E5%8F%A4%E4%BB%8A/boot-%E8%AE%A1%E7%AE%97%E6%9C%BA/ class=md-tabs__link> 纵观古今 </a> </li> <li class=md-tabs__item> <a href=../%E7%94%B5%E5%BD%B1%E4%B8%8B%E8%BD%BD/%E7%99%BE%E5%BA%A6%E4%BA%91%E6%BB%A1%E5%AE%BD%E5%B8%A6%E4%B8%8B%E8%BD%BD/ class=md-tabs__link> 横看当前 </a> </li> <li class=md-tabs__item> <a href=../../%E4%B8%BA%E6%88%91%E6%89%80%E7%94%A8/hello-world/ class=md-tabs__link> 为我所用 </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=David&amp;Blog class="md-nav__button md-logo" aria-label=David&amp;Blog> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z"/></svg> </a> David&Blog </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=首页 class=md-nav__link> 首页 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> 纵观古今 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label=纵观古今 data-md-level=1> <label class=md-nav__title for=nav-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> 纵观古今 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../%E7%BA%B5%E8%A7%82%E5%8F%A4%E4%BB%8A/boot-%E8%AE%A1%E7%AE%97%E6%9C%BA/ title=计算机启动原理 class=md-nav__link> 计算机启动原理 </a> </li> <li class=md-nav__item> <a href=../../%E7%BA%B5%E8%A7%82%E5%8F%A4%E4%BB%8A/%E5%88%9D%E5%A7%8B%E5%8C%96%E8%BF%9B%E7%A8%8B/ title=初始化进程 class=md-nav__link> 初始化进程 </a> </li> <li class=md-nav__item> <a href=../../%E7%BA%B5%E8%A7%82%E5%8F%A4%E4%BB%8A/docker-vs-%E8%99%9A%E6%8B%9F%E6%9C%BA/ title=docker与虚拟机对比 class=md-nav__link> docker与虚拟机对比 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2-4 type=checkbox id=nav-2-4> <label class=md-nav__link for=nav-2-4> test <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label=test data-md-level=2> <label class=md-nav__title for=nav-2-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> test </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../%E7%BA%B5%E8%A7%82%E5%8F%A4%E4%BB%8A/test/test/ title=测试 class=md-nav__link> 测试 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3 type=checkbox id=nav-3 checked> <label class=md-nav__link for=nav-3> 横看当前 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label=横看当前 data-md-level=1> <label class=md-nav__title for=nav-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> 横看当前 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-1 type=checkbox id=nav-3-1> <label class=md-nav__link for=nav-3-1> 电影下载 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label=电影下载 data-md-level=2> <label class=md-nav__title for=nav-3-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> 电影下载 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../%E7%94%B5%E5%BD%B1%E4%B8%8B%E8%BD%BD/%E7%99%BE%E5%BA%A6%E4%BA%91%E6%BB%A1%E5%AE%BD%E5%B8%A6%E4%B8%8B%E8%BD%BD/ title=百度下载 class=md-nav__link> 百度下载 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <a href=./ title=Docker入门 class="md-nav__link md-nav__link--active"> Docker入门 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> 为我所用 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label=为我所用 data-md-level=1> <label class=md-nav__title for=nav-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> 为我所用 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../%E4%B8%BA%E6%88%91%E6%89%80%E7%94%A8/hello-world/ title=test class=md-nav__link> test </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <p><img align=center/ src=" /images/Docker.png"></p> <h1 id=_1>简介</h1> <p><strong>Docker 属于 Linux 容器的一种封装，提供简单易用的容器使用接口</strong>,Docker 将应用程序与该程序的依赖，打包在一个文件里面。运行这个文件，就会生成一个虚拟容器。程序在这个虚拟容器里运行，就好像在真实的物理机上运行一样。有了 Docker，就不用担心环境问题。 <!--more--></p> <h1 id=_2>功能</h1> <p>Docker 的主要用途，目前有三大类。</p> <p><strong>（1）提供一次性的环境。</strong>比如，本地测试他人的软件、持续集成的时候提供单元测试和构建的环境。</p> <p><strong>（2）提供弹性的云服务。</strong>因为 Docker容器可以随开随关，很适合动态扩容和缩容。</p> <p><strong>（3）组建微服务架构。</strong>通过多个容器，一台机器可以跑多个服务，因此在本机就可以模拟出微服务架构。</p> <h1 id=_3>实现</h1> <h2 id=_4>安装</h2> <p>Docker 是一个开源的商业产品，有两个版本：社区版（Community Edition，缩写为 CE）和企业版（Enterprise Edition，缩写为 EE）。企业版包含了一些收费服务，个人开发者一般用不到。下面的介绍都针对社区版。</p> <ul> <li><a href=https://docs.docker.com/docker-for-windows/install/ >Windows</a></li> <li><a href=https://docs.docker.com/install/linux/docker-ce/ubuntu/ >Ubuntu</a></li> <li><a href=https://docs.docker.com/install/linux/docker-ce/debian/ >Debian</a></li> <li><a href=https://docs.docker.com/install/linux/docker-ce/centos/ >CentOS</a></li> </ul> <h3 id=_5>验证</h3> <div class=codehilite><pre><span></span><code>$ docker version
<span class=c1># 或者</span>
$ docker info
</code></pre></div> <h3 id=sudo>sudo权限</h3> <p>Docker 需要用户具有 sudo 权限，为了避免每次命令都输入<code>sudo</code>，可以把用户加入 Docker 用户组</p> <div class=codehilite><pre><span></span><code>$ sudo usermod -aG docker <span class=nv>$USER</span>
</code></pre></div> <h3 id=->服务器-客户端架构</h3> <p>命令行运行<code>docker</code>命令的时候，需要本机有 Docker 服务。如果这项服务没有启动，可以用下面的命令启动</p> <div class=codehilite><pre><span></span><code><span class=o>#</span> <span class=n>service</span> <span class=err>命令的用法</span>
<span class=err>$</span> <span class=n>sudo</span> <span class=n>service</span> <span class=n>docker</span> <span class=k>start</span>

<span class=o>#</span> <span class=n>systemctl</span> <span class=err>命令的用法</span>
<span class=err>$</span> <span class=n>sudo</span> <span class=n>systemctl</span> <span class=k>start</span> <span class=n>docker</span>
</code></pre></div> <h2 id=_6>文件说明</h2> <h3 id=dockerfile>Dockerfile 文件</h3> <p>一个文本文件,用来配置 image。Docker根据 该文件生成二进制的image文件</p> <h3 id=image>image文件</h3> <ul> <li> <p><strong>Docker把应用程序及其依赖，打包在 image 文件里面。</strong>只有通过这个文件，才能生成 Docker 容器。image 文件可以看作是容器的模板。Docker 根据 image 文件生成容器的实例。同一个 image 文件，可以生成多个同时运行的容器实例</p> </li> <li> <p><strong>image是二进制文件</strong>。实际开发中，一个 image 文件往往通过继承另一个 image 文件，加上一些个性化设置而生成。举例来说，你可以在 Ubuntu 的 image 基础上，往里面加入 Apache 服务器，形成你的 image</p> </li> </ul> <p>``` # 列出本机的所有 image 文件。 $ docker image ls</p> <p># 删除 image 文件 $ docker image rm [imageName] ```</p> <ul> <li>image 文件是通用的，一台机器的 image 文件拷贝到另一台机器，照样可以使用。Docker 的官方仓库 <a href=https://hub.docker.com/ >Docker Hub</a> 是最重要、最常用的 image 仓库。</li> </ul> <h3 id=_7>容器文件</h3> <p><strong>image 文件生成的容器实例，本身也是一个文件，称为容器文件。</strong>也就是说，一旦容器生成，就会同时存在两个文件： image 文件和容器文件。而且关闭容器并不会删除容器文件，只是容器停止运行而已。</p> <div class=codehilite><pre><span></span><code><span class=o>#</span> <span class=err>列出本机正在运行的容器</span>
<span class=err>$</span> <span class=n>docker</span> <span class=n>container</span> <span class=n>ls</span>

<span class=o>#</span> <span class=err>列出本机所有容器，包括终止运行的容器</span>
<span class=err>$</span> <span class=n>docker</span> <span class=n>container</span> <span class=n>ls</span> <span class=c1>--all</span>
</code></pre></div> <p>上面命令的输出结果之中，包括容器的 ID。很多地方都需要提供这个 ID，比如上一节终止容器运行的<code>docker container kill</code>命令。</p> <p>终止运行的容器文件，依然会占据硬盘空间，可以使用<code>docker container rm</code>命令删除。</p> <h2 id=_8>实践：</h2> <p>制作自己的 Docker 容器</p> <h3 id=_9>准备工作</h3> <p><a href=https://github.com/ruanyf/koa-demos/archive/master.zip>下载源码</a></p> <div class=codehilite><pre><span></span><code>$ git clone https://github.com/ruanyf/koa-demos.git
$ <span class=nb>cd</span> koa-demos
</code></pre></div> <h3 id=dockerfile_1>编写Dockerfile文件</h3> <p>首先，在项目的根目录下，新建一个文本文件<code>.dockerignore</code>，写入下面的<a href=https://github.com/ruanyf/koa-demos/blob/master/.dockerignore>内容</a>。</p> <blockquote> <p><code>.git node_modules npm-debug.log</code></p> </blockquote> <p>上面代码表示，这三个路径要排除，不要打包进入 image 文件。如果你没有路径要排除，这个文件可以不新建。</p> <p>然后，在项目的根目录下，新建一个文本文件 Dockerfile，写入下面的<a href=https://github.com/ruanyf/koa-demos/blob/master/Dockerfile>内容</a>。</p> <blockquote> <p><code>FROM node:8.4 COPY . /app WORKDIR /app RUN npm install --registry=https://registry.npm.taobao.org EXPOSE 3000</code></p> </blockquote> <p>上面代码一共五行，含义如下。</p> <blockquote> <ul> <li><code>FROM node:8.4</code>：该 image 文件继承官方的 node image，冒号表示标签，这里标签是<code>8.4</code>，即8.4版本的 node。</li> <li><code>COPY . /app</code>：将当前目录下的所有文件（除了<code>.dockerignore</code>排除的路径），都拷贝进入 image 文件的<code>/app</code>目录。</li> <li><code>WORKDIR /app</code>：指定接下来的工作路径为<code>/app</code>。</li> <li><code>RUN npm install</code>：在<code>/app</code>目录下，运行<code>npm install</code>命令安装依赖。注意，安装后所有的依赖，都将打包进入 image 文件。</li> <li><code>EXPOSE 3000</code>：将容器 3000 端口暴露出来， 允许外部连接这个端口。</li> </ul> </blockquote> <h3 id=image_1>创建image文件</h3> <p>有了 Dockerfile 文件以后，就可以使用<code>docker image build</code>命令创建 image 文件了。</p> <blockquote> <p>``` $ docker image build -t koa-demo .</p> <h1 id=_10>或者</h1> <p>$ docker image build -t koa-demo:0.0.1 . ```</p> </blockquote> <p>上面代码中，<code>-t</code>参数用来指定 image 文件的名字，后面还可以用冒号指定标签。如果不指定，默认的标签就是<code>latest</code>。最后的那个点表示 Dockerfile 文件所在的路径，上例是当前路径，所以是一个点。</p> <p>如果运行成功，就可以看到新生成的 image 文件<code>koa-demo</code>了。</p> <blockquote> <p><code>$ docker image ls</code></p> </blockquote> <h3 id=_11>生成容器</h3> <p><code>docker container run</code>命令会从 image 文件生成容器。</p> <blockquote> <p>``` $ docker container run -p 8000:3000 -it koa-demo /bin/bash</p> <h1 id=_12>或者</h1> <p>$ docker container run -p 8000:3000 -it koa-demo:0.0.1 /bin/bash ```</p> </blockquote> <p>上面命令的各个参数含义如下：</p> <blockquote> <ul> <li><code>-p</code>参数：容器的 3000 端口映射到本机的 8000 端口。</li> <li><code>-it</code>参数：容器的 Shell 映射到当前的 Shell，然后你在本机窗口输入的命令，就会传入容器。</li> <li><code>koa-demo:0.0.1</code>：image 文件的名字（如果有标签，还需要提供标签，默认是 latest 标签）。</li> <li><code>/bin/bash</code>：容器启动以后，内部第一个执行的命令。这里是启动 Bash，保证用户可以使用 Shell。</li> </ul> </blockquote> <p>如果一切正常，运行上面的命令以后，就会返回一个命令行提示符。</p> <blockquote> <p><code>root@66d80f4aaf1e:/app#</code></p> </blockquote> <p>这表示你已经在容器里面了，返回的提示符就是容器内部的 Shell 提示符。执行下面的命令。</p> <blockquote> <p><code>root@66d80f4aaf1e:/app# node demos/01.js</code></p> </blockquote> <p>这时，Koa 框架已经运行起来了。打开本机的浏览器，访问 http://127.0.0.1:8000，网页显示"Not Found"，这是因为这个 <a href=https://github.com/ruanyf/koa-demos/blob/master/demos/01.js>demo</a> 没有写路由。</p> <p>这个例子中，Node 进程运行在 Docker 容器的虚拟环境里面，进程接触到的文件系统和网络接口都是虚拟的，与本机的文件系统和网络接口是隔离的，因此需要定义容器与物理机的端口映射（map）。</p> <p>现在，在容器的命令行，按下 Ctrl + c 停止 Node 进程，然后按下 Ctrl + d （或者输入 exit）退出容器。此外，也可以用<code>docker container kill</code>终止容器运行。</p> <blockquote> <p>```</p> <h1 id=id>在本机的另一个终端窗口，查出容器的 ID</h1> <p>$ docker container ls</p> <h1 id=_13>停止指定的容器运行</h1> <p>$ docker container kill [containerID] ```</p> </blockquote> <p>容器停止运行之后，并不会消失，用下面的命令删除容器文件。</p> <blockquote> <p>```</p> <h1 id=id_1>查出容器的 ID</h1> <p>$ docker container ls --all</p> <h1 id=_14>删除指定的容器文件</h1> <p>$ docker container rm [containerID] ```</p> </blockquote> <p>也可以使用<code>docker container run</code>命令的<code>--rm</code>参数，在容器终止运行后自动删除容器文件。</p> <blockquote> <p><code>$ docker container run --rm -p 8000:3000 -it koa-demo /bin/bash</code></p> </blockquote> <h3 id=cmd>添加CMD命令</h3> <p>上一节的例子里面，容器启动以后，需要手动输入命令<code>node demos/01.js</code>。我们可以把这个命令写在 Dockerfile 里面，这样容器启动以后，这个命令就已经执行了，不用再手动输入了。</p> <blockquote> <p><code>FROM node:8.4 COPY . /app WORKDIR /app RUN npm install --registry=https://registry.npm.taobao.org EXPOSE 3000 CMD node demos/01.js</code></p> </blockquote> <p>上面的 Dockerfile 里面，多了最后一行<code>CMD node demos/01.js</code>，它表示容器启动后自动执行<code>node demos/01.js</code>。</p> <p>你可能会问，<code>RUN</code>命令与<code>CMD</code>命令的区别在哪里？简单说，<code>RUN</code>命令在 image 文件的构建阶段执行，执行结果都会打包进入 image 文件；<code>CMD</code>命令则是在容器启动后执行。另外，一个 Dockerfile 可以包含多个<code>RUN</code>命令，但是只能有一个<code>CMD</code>命令。</p> <p>注意，指定了<code>CMD</code>命令以后，<code>docker container run</code>命令就不能附加命令了（比如前面的<code>/bin/bash</code>），否则它会覆盖<code>CMD</code>命令。现在，启动容器可以使用下面的命令。</p> <blockquote> <p><code>$ docker container run --rm -p 8000:3000 -it koa-demo:0.0.1</code></p> </blockquote> <h3 id=image_2>发布image文件</h3> <p>容器运行成功后，就确认了 image 文件的有效性。这时，我们就可以考虑把 image 文件分享到网上，让其他人使用。</p> <p>首先，去 <a href=https://hub.docker.com/ >hub.docker.com</a> 或 <a href=https://cloud.docker.com/ >cloud.docker.com</a> 注册一个账户。然后，用下面的命令登录。</p> <blockquote> <p><code>$ docker login</code></p> </blockquote> <p>接着，为本地的 image 标注用户名和版本。</p> <blockquote> <p>``` $ docker image tag [imageName] [username]/[repository]:[tag]</p> <h1 id=_15>实例</h1> <p>$ docker image tag koa-demos:0.0.1 ruanyf/koa-demos:0.0.1 ```</p> </blockquote> <p>也可以不标注用户名，重新构建一下 image 文件。</p> <blockquote> <p><code>$ docker image build -t [username]/[repository]:[tag] .</code></p> </blockquote> <p>最后，发布 image 文件。</p> <blockquote> <p><code>$ docker image push [username]/[repository]:[tag]</code></p> </blockquote> <p>发布成功以后，登录 hub.docker.com，就可以看到已经发布的 image 文件。</p> <h2 id=_16>常用命令</h2> <h3 id=_17>启动容器</h3> <p>前面的<code>docker container run</code>命令是新建容器，每运行一次，就会新建一个容器。同样的命令运行两次，就会生成两个一模一样的容器文件。如果希望重复使用容器，就要使用<code>docker container start</code>命令，它用来启动已经生成、已经停止运行的容器文件。</p> <blockquote> <p><code>$ docker container start [containerID]</code></p> </blockquote> <h3 id=_18>停止容器</h3> <p>前面的<code>docker container kill</code>命令终止容器运行，相当于向容器里面的主进程发出 SIGKILL 信号。而<code>docker container stop</code>命令也是用来终止容器运行，相当于向容器里面的主进程发出 SIGTERM 信号，然后过一段时间再发出 SIGKILL 信号。</p> <blockquote> <p><code>$ bash container stop [containerID]</code></p> </blockquote> <p>这两个信号的差别是，应用程序收到 SIGTERM 信号以后，可以自行进行收尾清理工作，但也可以不理会这个信号。如果收到 SIGKILL 信号，就会强行立即终止，那些正在进行中的操作会全部丢失。</p> <h3 id=_19>查看容器日志</h3> <p><code>docker container logs</code>命令用来查看 docker 容器的输出，即容器里面 Shell 的标准输出。如果<code>docker run</code>命令运行容器的时候，没有使用<code>-it</code>参数，就要用这个命令查看输出。</p> <blockquote> <p><code>$ docker container logs [containerID]</code></p> </blockquote> <h3 id=shell>执行shell命令</h3> <p><code>docker container exec</code>命令用于进入一个正在运行的 docker 容器。如果<code>docker run</code>命令运行容器的时候，没有使用<code>-it</code>参数，就要用这个命令进入容器。一旦进入了容器，就可以在容器的 Shell 执行命令了。</p> <blockquote> <p><code>$ docker container exec -it [containerID] /bin/bash</code></p> </blockquote> <h3 id=cp>文件从容器cp到本机</h3> <p><code>docker container cp</code>命令用于从正在运行的 Docker 容器里面，将文件拷贝到本机。下面是拷贝到当前目录的写法。</p> <blockquote> <p><code>$ docker container cp [containID]:[/path/to/file] .</code></p> </blockquote> <h1 id=_20>参考资料</h1> <blockquote> <ul> <li><a href=http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html>Docker 入门教程</a></li> <li><a href=http://www.less-is-more.top/wiki/%E7%BA%B5%E8%A7%82%E5%8F%A4%E4%BB%8A/docker-vs-%E8%99%9A%E6%8B%9F%E6%9C%BA/ >docker vs 虚拟机</a></li> <li><a href=http://www.docker.org.cn/docker/151.html>八个Docker的真实应用场景</a></li> <li><a href=https://www.w3cschool.cn/docker/ >w3cschool/docker教程</a></li> </ul> </blockquote> <hr> <div class=md-source-date> <small> 最后更新: 2020年4月25日 </small> </div> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label> <a href=../%E7%94%B5%E5%BD%B1%E4%B8%8B%E8%BD%BD/%E7%99%BE%E5%BA%A6%E4%BA%91%E6%BB%A1%E5%AE%BD%E5%B8%A6%E4%B8%8B%E8%BD%BD/ title=百度下载 class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> 上一页 </span> 百度下载 </div> </div> </a> <a href=../../%E4%B8%BA%E6%88%91%E6%89%80%E7%94%A8/hello-world/ title=test class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> 下一页 </span> test </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z /></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/vendor.36cbf620.min.js></script> <script src=../../assets/javascripts/bundle.00c583dd.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "", "search.config.separator": "[\\uff0c\\u3002]+", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c"}</script> <script>
        app = initialize({
          base: "../..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.7f7c8775.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>